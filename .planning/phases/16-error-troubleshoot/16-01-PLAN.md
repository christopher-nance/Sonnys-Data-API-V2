---
phase: 16-error-troubleshoot
plan: 01
type: execute
---

<objective>
Create a comprehensive error handling patterns guide covering the exception hierarchy, catching strategies, error attributes, per-exception-type guidance, built-in retry behavior, and custom retry recipes.

Purpose: Give developers and AI agents practical, copy-paste-ready patterns for handling every error the SDK can throw — filling the gap between the auto-generated API reference and real-world usage.
Output: `docs/guides/error-handling.md` with full error handling coverage.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Source files (the code being documented):
@src/sonnys_data_client/_exceptions.py
@src/sonnys_data_client/_client.py
@src/sonnys_data_client/_rate_limiter.py

# Existing exception reference (auto-generated, minimal):
@docs/api/exceptions.md

# Style reference (follow established guide patterns):
@docs/guides/transactions.md
@docs/guides/customers.md

**Established patterns from prior phases:**
- Guides use mkdocs-material admonitions (`!!! note`, `!!! warning`, `!!! tip`, `!!! info`)
- Code examples use `python` fenced blocks with `content.code.copy` enabled
- Parameter/attribute tables use markdown pipe tables
- Each guide opens with a 2-3 sentence description of what the resource/topic covers
- Guides link to API reference pages where relevant
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create error handling guide — hierarchy, catching patterns, error attributes</name>
  <files>docs/guides/error-handling.md</files>
  <action>
Create `docs/guides/error-handling.md` with these sections:

**1. Opening paragraph** — 2-3 sentences: the SDK raises typed exceptions for every failure mode; catch broad or narrow as needed.

**2. Exception Hierarchy** — ASCII tree diagram (same as in api/exceptions.md but with one-line descriptions for each class):
- SonnysError (base for all SDK errors)
- APIError (base for API-related errors)
- APIConnectionError (network failures)
- APITimeoutError (request timeouts)
- APIStatusError (HTTP error responses)
- AuthError (403 — credential/authorization problems)
- RateLimitError (429 — rate limit exceeded)
- ValidationError (400/422 — bad request parameters)
- NotFoundError (404 — resource not found)
- ServerError (5xx — server-side failures)

**3. Catching Errors** — show three patterns:
- Catch-all with SonnysError (simplest)
- Catch by category: network (APIConnectionError) vs HTTP (APIStatusError)
- Catch specific: AuthError, RateLimitError, NotFoundError, etc.
Include a `!!! tip` admonition: "Order specific exceptions before general ones — Python matches the first `except` clause."

**4. Error Attributes** — table of attributes on APIStatusError subclasses:
- `message` (str) — human-readable error description
- `status_code` (int) — HTTP status code
- `body` (dict | None) — full parsed response body from the API
- `error_type` (str | None) — Sonny's API error type string (e.g., "BadClientCredentialsError", "EntityNotFoundError")
Show a code example accessing these attributes in an except block.
Include `!!! info` admonition with the full error_type → exception class mapping table from PROJECT.md.

**5. Per-Exception-Type Guidance** — a subsection for each exception type with:
- When it's raised
- Common causes
- Recommended handling
- Code example

Cover: AuthError (bad credentials, wrong site code, unauthorized site), RateLimitError (burst traffic, multiple scripts), ValidationError (bad date format, invalid params), NotFoundError (wrong ID, deleted record), ServerError (API outage, transient failure), APIConnectionError (network down, DNS failure), APITimeoutError (slow response, large query).

**6. Built-in Retry Behavior** — explain what the SDK does automatically:
- Pre-request rate limiting: 20 req/15s sliding window, client sleeps if at capacity
- 429 retry: exponential backoff (1s, 2s, 4s) up to max_retries (default 3)
- What is NOT retried: connection errors, timeouts, non-429 HTTP errors
Include `!!! note` about max_retries constructor parameter.

**7. Custom Retry Patterns** — practical recipes:
- Retry with backoff for transient ServerError (500/502/503)
- Retry for APIConnectionError/APITimeoutError
- Use tenacity library for production retry (show pip install + example)
Include `!!! warning`: "Never retry AuthError or ValidationError — these indicate a code/config problem, not a transient failure."

Use admonitions consistently. Keep code examples realistic (use actual client methods like `client.transactions.list(startDate=..., endDate=...)`). Do NOT add emojis.
  </action>
  <verify>Confirm file exists and has all 7 sections: hierarchy, catching, attributes, per-type guidance, built-in retry, custom retry. Check no broken markdown.</verify>
  <done>docs/guides/error-handling.md exists with complete error handling guide covering all exception types, attributes, catching patterns, retry behavior, and custom retry recipes.</done>
</task>

<task type="auto">
  <name>Task 2: Add realistic scenario examples for each error type</name>
  <files>docs/guides/error-handling.md</files>
  <action>
Review the guide created in Task 1 and enrich the per-exception-type sections with realistic, scenario-based examples. Each exception type section should have at minimum:

- A "Common causes" list that reflects real Sonny's API usage (not generic):
  - AuthError: wrong api_id/api_key, site_code not authorized for this API ID, missing credentials
  - RateLimitError: running analytics script alongside scheduled automation, bulk exports without rate awareness
  - ValidationError: date format "06/01/2025" instead of "2025-06-01", requesting transaction type that doesn't exist
  - NotFoundError: transaction ID from wrong site, deleted customer record
  - ServerError: Sonny's API maintenance window, intermittent 500s on large queries
  - APIConnectionError: corporate firewall blocking trigonapi.sonnyscontrols.com, DNS resolution failure
  - APITimeoutError: load_job on very large date ranges

- A practical code example showing the recommended handling pattern for that specific error.

Also add a "Quick Reference" section at the end — a single markdown table mapping HTTP status → exception class → typical cause → recommended action. This serves as a scannable cheat sheet.

Ensure all code examples use proper imports (`from sonnys_data_client import SonnysClient, AuthError, ...`) and realistic parameter values.
  </action>
  <verify>Grep for all 7 exception type names in the file. Verify the Quick Reference table exists at the end.</verify>
  <done>Each exception type has realistic scenario examples with Sonny's-specific causes, and a Quick Reference table provides a scannable cheat sheet at the end.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `docs/guides/error-handling.md` exists with all sections
- [ ] All 7 exception types documented with examples
- [ ] Quick Reference table at end of guide
- [ ] Admonitions used consistently (note, warning, tip, info)
- [ ] Code examples use realistic Sonny's API parameters
- [ ] No broken markdown (check with `python -m mkdocs build 2>&1 | head -20`)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Guide covers every exception in the hierarchy
- Code examples are copy-paste ready
- Content fills the gap between auto-generated API reference and practical usage
</success_criteria>

<output>
After completion, create `.planning/phases/16-error-troubleshoot/16-01-SUMMARY.md`
</output>
