---
phase: 27-labor-data-layer
plan: 01
type: tdd
---

<objective>
Add a date range chunking utility that splits arbitrary date ranges into
<=14-day windows, required by the clock entries API endpoint.

Purpose: The Sonny's API enforces a hard 14-day max on clock entry date
ranges.  This utility lets callers pass any date range and get back a list
of (start, end) string pairs safe to pass to the API.

Output: Tested `build_date_chunks()` function in `_date_utils.py`.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/27-labor-data-layer/27-RESEARCH.md

@src/sonnys_data_client/_date_utils.py
@tests/test_date_utils.py
</context>

<feature>
  <name>build_date_chunks — 14-day date range splitter</name>
  <files>src/sonnys_data_client/_date_utils.py, tests/test_date_utils.py</files>
  <behavior>
    build_date_chunks(start: str, end: str, max_days: int = 14) -> list[tuple[str, str]]

    Accepts YYYY-MM-DD strings.  Returns list of (start, end) string tuples
    where each chunk spans at most `max_days` days (inclusive).

    Cases:
      ("2026-01-01", "2026-01-01") → [("2026-01-01", "2026-01-01")]          # single day
      ("2026-01-01", "2026-01-14") → [("2026-01-01", "2026-01-14")]          # exact 14 days
      ("2026-01-01", "2026-01-15") → [("2026-01-01", "2026-01-14"),
                                       ("2026-01-15", "2026-01-15")]          # 15 days → 2 chunks
      ("2026-01-01", "2026-01-31") → [("2026-01-01", "2026-01-14"),
                                       ("2026-01-15", "2026-01-28"),
                                       ("2026-01-29", "2026-01-31")]          # 31 days → 3 chunks
      ("2026-01-28", "2026-02-10") → [("2026-01-28", "2026-02-10")]          # 14 days cross-month
      ("2026-01-01", "2026-01-31", max_days=7) → 5 chunks of 7 days         # custom max_days
      ("2026-02-01", "2026-01-01") → ValueError                              # start > end

    End dates are INCLUSIVE (day 1 to day 14 = 14 days, not 13).
  </behavior>
  <implementation>
    Parse start/end as date objects.  Loop: chunk_start = current, chunk_end =
    min(current + timedelta(days=max_days-1), end_date).  Append as YYYY-MM-DD
    strings.  Advance current = chunk_end + 1 day.  Stop when current > end.
    Raise ValueError if start > end.
  </implementation>
</feature>

<verification>
python -m pytest tests/test_date_utils.py -v
</verification>

<success_criteria>

- Failing tests written and committed (RED)
- Implementation passes all tests (GREEN)
- Refactored if needed (REFACTOR)
- All existing date_utils tests still pass
- build_date_chunks exported from _date_utils module
</success_criteria>

<output>
After completion, create `.planning/phases/27-labor-data-layer/27-01-SUMMARY.md`
</output>
