---
phase: 19-stats-foundation
plan: 02
type: execute
---

<objective>
Create StatsResource class and wire it to the client as `client.stats`.

Purpose: Establish the stats module entry point that all stat methods (Phases 21-25) will be added to. The foundation class provides date resolution helpers and follows the established resource pattern.
Output: Working `client.stats` property returning a `StatsResource` instance with `_resolve_dates()` helper.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-stats-foundation/19-01-SUMMARY.md
@src/sonnys_data_client/_client.py
@src/sonnys_data_client/_resources.py
@src/sonnys_data_client/_date_utils.py
@src/sonnys_data_client/resources/__init__.py
@src/sonnys_data_client/__init__.py

**Established patterns:**
- Resource classes extend BaseResource, store `_client` reference
- `functools.cached_property` for lazy resource init on SonnysClient
- `TYPE_CHECKING` guard for circular imports in resource modules
- Underscore prefix for internal modules (`_stats.py`)
- Google-style docstrings on all public classes/methods

**Constraining decisions:**
- Phase 5: BaseResource pattern — StatsResource extends BaseResource only (not ListableResource/GettableResource since stats don't wrap API endpoints)
- Phase 19-01: `parse_date_range()` from `_date_utils.py` for date handling
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StatsResource class</name>
  <files>src/sonnys_data_client/resources/_stats.py</files>
  <action>
    Create `_stats.py` with `StatsResource(BaseResource)`:

    - Import `BaseResource` from `sonnys_data_client._resources`
    - Import `parse_date_range` from `sonnys_data_client._date_utils`
    - Import `datetime` for type hints
    - Use `TYPE_CHECKING` guard for `SonnysClient` import (same pattern as `_resources.py`)

    Add `_resolve_dates(self, start, end)` helper method:
    - Calls `parse_date_range(start, end)` to validate and normalize
    - Converts both datetimes to Unix timestamps (int)
    - Returns dict `{"startDate": start_ts, "endDate": end_ts}` ready for passing to `client.transactions.list()` and similar calls
    - This avoids every stat method repeating date conversion logic

    Google docstrings on class and method. Class docstring should note that stat methods will be added in Phases 21-25. Method docstring should document args (str | datetime) and return type (dict with startDate/endDate as Unix timestamps).

    Do NOT add any stat methods yet — those come in Phases 21-25. This is foundation only.
  </action>
  <verify>python -c "from sonnys_data_client.resources._stats import StatsResource; print('OK')"</verify>
  <done>StatsResource class importable with _resolve_dates() method, Google docstrings present</done>
</task>

<task type="auto">
  <name>Task 2: Wire client.stats property and update exports</name>
  <files>src/sonnys_data_client/_client.py, src/sonnys_data_client/resources/__init__.py, src/sonnys_data_client/__init__.py</files>
  <action>
    1. In `_client.py`:
       - Add import: `from sonnys_data_client.resources._stats import StatsResource`
       - Add `stats` cached_property (same pattern as `customers`, `transactions`, etc.):
         ```python
         @functools.cached_property
         def stats(self) -> StatsResource:
             """Access the Stats resource for business analytics."""
             return StatsResource(self)
         ```

    2. In `resources/__init__.py`:
       - Add `from sonnys_data_client.resources._stats import StatsResource`
       - Add `"StatsResource"` to `__all__`

    3. In `sonnys_data_client/__init__.py`:
       - Add `StatsResource` to the resources import line
       - Add `"StatsResource"` to `__all__`

    Follow exact patterns from existing resource wiring. Keep imports alphabetically sorted where the existing code does so.
  </action>
  <verify>python -c "from sonnys_data_client import SonnysClient, StatsResource; print('imports OK')"</verify>
  <done>client.stats property returns StatsResource instance, StatsResource exported from package __init__.py and resources __init__.py</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -c "from sonnys_data_client import SonnysClient, StatsResource"` succeeds
- [ ] `python -c "from sonnys_data_client._date_utils import parse_date_range"` succeeds
- [ ] `pytest tests/ -v` passes all existing tests (no regressions)
- [ ] StatsResource has `_resolve_dates()` returning dict with startDate/endDate timestamps
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No import errors or regressions
- `client.stats` accessible as cached_property
- StatsResource._resolve_dates() converts dates to Unix timestamp dict
- Phase 19 complete
</success_criteria>

<output>
After completion, create `.planning/phases/19-stats-foundation/19-02-SUMMARY.md`:

# Phase 19 Plan 2: StatsResource Class & Client Wiring Summary

**[Substantive one-liner]**

## Accomplishments

## Files Created/Modified

## Decisions Made

## Issues Encountered

## Next Step
Phase 19 complete, ready for Phase 20 (Data Fetching Layer)
</output>
