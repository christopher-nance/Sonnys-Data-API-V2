---
phase: 14-transaction-deep-dive
plan: 02
type: execute
---

<objective>
Add advanced transaction patterns section and finalize the deep dive guide with cleanup and deployment.

Purpose: Complete the transaction deep dive with practical advanced usage patterns that help developers handle real-world scenarios.
Output: Finalized docs/guides/transactions.md with advanced patterns, clean build, and deployed docs site.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-transaction-deep-dive/14-01-SUMMARY.md

@docs/guides/transactions.md
@src/sonnys_data_client/resources/_transactions.py
@src/sonnys_data_client/types/_transactions.py
@src/sonnys_data_client/_exceptions.py
@mkdocs.yml

**Constraining decisions:**
- Phase 14-01: Added method comparison, parameter tables, and batch job workflow sections
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add advanced transaction patterns section</name>
  <files>docs/guides/transactions.md</files>
  <action>
Insert a new "## Advanced Patterns" section AFTER the "## Models" section (before the closing auto-pagination admonition note). Include these subsections:

**1. "### Multi-Day Exports" subsection** — Since `load_job()` is limited to 24-hour date ranges, show the pattern for exporting multiple days:

```python
from datetime import date, timedelta
from sonnys_data_client import SonnysClient

with SonnysClient(api_id="your-api-id", api_key="your-api-key") as client:
    start = date(2025, 6, 1)
    end = date(2025, 6, 30)
    all_results = []

    current = start
    while current < end:
        next_day = current + timedelta(days=1)
        day_results = client.transactions.load_job(
            startDate=current.isoformat(),
            endDate=next_day.isoformat(),
        )
        all_results.extend(day_results)
        current = next_day

    print(f"Exported {len(all_results)} transactions over {(end - start).days} days")
```

Add an admonition tip: for very large exports, consider adding a small sleep between days to stay well within the rate limit (the client handles 429 retries automatically, but spacing requests reduces retry churn).

**2. "### Error Handling" subsection** — Show transaction-specific error handling patterns:

```python
from sonnys_data_client import SonnysClient
from sonnys_data_client._exceptions import (
    APIError,
    APITimeoutError,
    RateLimitError,
    ValidationError,
)

with SonnysClient(api_id="your-api-id", api_key="your-api-key") as client:
    try:
        results = client.transactions.load_job(
            startDate="2025-06-15",
            endDate="2025-06-16",
            timeout=600.0,
        )
    except APITimeoutError:
        print("Job timed out — try a shorter date range or increase timeout")
    except APIError as e:
        print(f"Job failed: {e}")
    except RateLimitError:
        print("Rate limit exceeded after max retries")
```

Add a note about `ValidationError` — raised when date format is invalid or parameters fail API validation.

**3. "### Cross-Resource Lookups" subsection** — Show how to enrich transaction data with other resources:

```python
with SonnysClient(api_id="your-api-id", api_key="your-api-key") as client:
    # Get enriched transactions with customer_id
    transactions = client.transactions.list_v2(
        startDate="2025-06-01",
        endDate="2025-06-30",
    )

    # Build customer lookup from customer_ids found in transactions
    customer_ids = {t.customer_id for t in transactions if t.customer_id}
    customers = {
        c.customer_id: c
        for c in client.customers.list()
        if c.customer_id in customer_ids
    }

    # Enrich transactions with customer names
    for txn in transactions:
        if txn.customer_id and txn.customer_id in customers:
            customer = customers[txn.customer_id]
            print(f"#{txn.trans_number}: ${txn.total:.2f} — {customer.first_name} {customer.last_name}")
```

Then REMOVE the Phase 14 forward-reference tip at the bottom of the file (the admonition starting with `!!! tip "Transaction deep dive"`). Keep the auto-pagination note.

Also update the Phase 15 forward-reference tip in docs/guides/recurring.md — change it from referencing "Phase 15" to something useful like: `!!! tip "See also"` with text: "For patterns combining recurring accounts with transaction data, see the [Transactions](transactions.md#cross-resource-lookups) guide."
  </action>
  <verify>Run `cd "C:\Users\chris\OneDrive - WashU Carwash\Projects\Sonny's Data API V2" && python -m mkdocs build --strict 2>&1` — should complete with zero warnings and zero errors. Verify the Phase 14 forward-reference tip is removed from transactions.md.</verify>
  <done>Advanced Patterns section added with multi-day exports, error handling, and cross-resource lookups. Phase 14 forward-reference removed. Recurring guide tip updated. mkdocs build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Deploy documentation site</name>
  <files>docs/guides/transactions.md</files>
  <action>
Deploy the updated documentation to GitHub Pages:

```bash
cd "C:\Users\chris\OneDrive - WashU Carwash\Projects\Sonny's Data API V2"
python -m mkdocs gh-deploy --strict --force
```

Verify the deployment succeeds without errors.
  </action>
  <verify>mkdocs gh-deploy completes successfully. The transactions deep dive guide is live on GitHub Pages.</verify>
  <done>Documentation deployed to GitHub Pages. Phase 14 complete.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -m mkdocs build --strict` succeeds with zero warnings
- [ ] "Advanced Patterns" section present with multi-day exports, error handling, cross-resource lookups
- [ ] Phase 14 forward-reference tip removed from transactions guide
- [ ] Recurring guide tip updated to link to transactions cross-resource section
- [ ] Documentation deployed to GitHub Pages
- [ ] Phase 14 complete
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No mkdocs build warnings or errors
- Documentation deployed to GitHub Pages
- Transaction deep dive guide is comprehensive and complete
</success_criteria>

<output>
After completion, create `.planning/phases/14-transaction-deep-dive/14-02-SUMMARY.md`
</output>
