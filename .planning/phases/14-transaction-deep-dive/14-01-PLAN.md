---
phase: 14-transaction-deep-dive
plan: 01
type: execute
---

<objective>
Expand the transactions guide with a method comparison section and formal parameter tables for all 5 methods, plus a detailed batch job workflow deep dive.

Purpose: Transform the existing transactions guide from a basic reference into the definitive deep-dive document for the SDK's most complex resource.
Output: Expanded docs/guides/transactions.md with method comparison, parameter tables, and batch job workflow sections.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-resource-guides/13-02-SUMMARY.md

@docs/guides/transactions.md
@src/sonnys_data_client/resources/_transactions.py
@src/sonnys_data_client/types/_transactions.py
@mkdocs.yml

**Tech stack available:** mkdocs-material>=9.5, mkdocstrings[python]>=0.24
**Established patterns:** Guide structure: H1 title, overview, H2 Methods, H2 Examples, H2 Models, admonitions
**Constraining decisions:**
- Phase 13-02: Created initial transactions guide with method signatures, examples, and model tables
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add method comparison and parameter tables</name>
  <files>docs/guides/transactions.md</files>
  <action>
Insert two new sections into the transactions guide BEFORE the existing "## Methods" section:

**1. "## Choosing the Right Method" section** — Add immediately after the opening overview paragraph. Include a comparison table:

| Method | Returns | Use When | Caching | Pagination |
|--------|---------|----------|---------|------------|
| `list()` | `TransactionListItem` | Quick summaries, date range queries | None | Auto |
| `list_by_type()` | `TransactionListItem` | Filtering by wash/prepaid/recurring/etc. | None | Auto |
| `list_v2()` | `TransactionV2ListItem` | Need customer_id, recurring flags, status | 10-min cache | Auto |
| `get()` | `Transaction` | Full detail for a single transaction | None | N/A |
| `load_job()` | `TransactionJobItem` | Bulk exports, full detail + v2 fields | 20-min cache | Auto (job-level) |

Follow with a brief prose guide: use `list()` for most queries, `list_by_type()` to narrow by type, `list_v2()` when you need enriched list data, `get()` for single transaction detail, and `load_job()` for bulk exports of full-detail records.

**2. "## Query Parameters" section** — Add after "Choosing the Right Method". Include a single consolidated parameter table since list(), list_by_type(), list_v2(), and load_job() all accept the same query parameters:

| Parameter | Type | Description |
|-----------|------|-------------|
| `startDate` | `str` | Start of date range (format: `YYYY-MM-DD`) |
| `endDate` | `str` | End of date range (format: `YYYY-MM-DD`) |
| `site` | `str` | Filter by site code |
| `region` | `str` | Filter by region |

Add a note: `limit` and `offset` are handled automatically by the client's auto-pagination — you do not need to set these manually. For `load_job()`, `limit` and `offset` control job-level pagination (default 100 records per job page).

Add an admonition noting that `get()` takes only `trans_id` as a positional argument and accepts no query parameters.

Do NOT modify any existing sections — only insert the two new sections before "## Methods".
  </action>
  <verify>Run `cd "C:\Users\chris\OneDrive - WashU Carwash\Projects\Sonny's Data API V2" && python -m mkdocs build --strict 2>&1` — should complete with zero warnings and zero errors.</verify>
  <done>Transactions guide has "Choosing the Right Method" comparison table and "Query Parameters" table inserted before the Methods section. mkdocs build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Add batch job workflow deep dive</name>
  <files>docs/guides/transactions.md</files>
  <action>
Insert a new "## Batch Job Workflow" section AFTER the "## Examples" section and BEFORE the "## Models" section. This section provides a detailed explanation of how `load_job()` works internally:

**1. "### How It Works" subsection** — Explain the three-phase workflow:

```
  ┌─────────────┐     ┌──────────────┐     ┌─────────────┐
  │  Submit Job  │────▶│  Poll Status  │────▶│   Return    │
  │  POST        │     │  GET          │     │   Results   │
  │  /load-job   │     │  /get-job-data│     │             │
  └─────────────┘     └──────┬───────┘     └─────────────┘
                             │
                        ┌────▼────┐
                        │ Status? │
                        └────┬────┘
                    ┌────────┼────────┐
                    ▼        ▼        ▼
                 "pass"  "working"  "fail"
                   │        │        │
                   │     sleep &     │
                   │     retry ──┐   │
                   │        ▲    │   │
                   │        └────┘   │
                   ▼                 ▼
               Return data     Raise APIError
```

Wrap the diagram in a ```text code fence for proper rendering.

**2. "### Job Status Lifecycle" subsection** — Describe the three status values:
- `"working"` — Job is still processing. Client sleeps for `poll_interval` seconds and retries.
- `"pass"` — Job complete. Data is available in the response.
- `"fail"` — Job failed. Client raises `APIError`.

**3. "### Multi-Page Jobs" subsection** — Explain that pagination happens at the job submission level: each `POST /load-job` with a different `offset` value submits a separate job. The client calculates total pages from the first job's `total` field and submits remaining jobs sequentially. Each job goes through its own submit → poll → return cycle.

**4. "### Timeouts and Errors" subsection** — Explain the two error scenarios:
- `APIError("Batch job failed")` — raised when job status is `"fail"`
- `APITimeoutError` — raised when a single job doesn't complete within `timeout` seconds (default 300s / 5 minutes)

Add an admonition: the `timeout` applies per job page, not to the entire load_job() call. A 500-record export with 100 records per page submits 5 jobs, each with its own timeout.

Do NOT modify any existing sections. Insert the new section between Examples and Models.
  </action>
  <verify>Run `cd "C:\Users\chris\OneDrive - WashU Carwash\Projects\Sonny's Data API V2" && python -m mkdocs build --strict 2>&1` — should complete with zero warnings and zero errors.</verify>
  <done>Transactions guide has "Batch Job Workflow" section with ASCII diagram, status lifecycle, multi-page explanation, and timeout/error documentation. mkdocs build passes.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -m mkdocs build --strict` succeeds with zero warnings
- [ ] "Choosing the Right Method" comparison table present in guide
- [ ] "Query Parameters" table present in guide
- [ ] "Batch Job Workflow" section with ASCII diagram present
- [ ] All existing content (Methods, Examples, Models) preserved unchanged
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No mkdocs build warnings or errors
- Guide reads naturally with new sections integrated
</success_criteria>

<output>
After completion, create `.planning/phases/14-transaction-deep-dive/14-01-SUMMARY.md`
</output>
