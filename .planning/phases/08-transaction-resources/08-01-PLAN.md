---
phase: 08-transaction-resources
plan: 01
type: execute
---

<objective>
Create the Transactions resource class with v1 list, detail, and by-type endpoints, then wire into SonnysClient.

Purpose: Implement the three core transaction endpoints — the most-used resource in the API — following the established resource mixin pattern.
Output: Working `Transactions` resource accessible via `client.transactions.list()`, `.get(id)`, `.list_by_type(item_type)`.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Dependency graph — selected via frontmatter:
@.planning/phases/05-resource-framework/05-01-SUMMARY.md
@.planning/phases/07-account-resources/07-02-SUMMARY.md

# Phase research:
@.planning/phases/08-transaction-resources/08-RESEARCH.md

# Key source files:
@src/sonnys_data_client/_resources.py
@src/sonnys_data_client/resources/_recurring.py
@src/sonnys_data_client/resources/_customers.py
@src/sonnys_data_client/types/_transactions.py
@src/sonnys_data_client/_client.py
@src/sonnys_data_client/resources/__init__.py
@src/sonnys_data_client/__init__.py

**Tech stack available:** ListableResource, GettableResource, _paginated_fetch pattern, SonnysModel with camelCase aliasing
**Established patterns:** Resource mixin pattern (subclass sets class attrs, inherits list()/get()), _paginated_fetch for custom paginated endpoints, functools.cached_property for client accessors, TYPE_CHECKING guard for circular imports
**Constraining decisions:**
- Phase 5: ListableResource/GettableResource as independent mixins — concrete resources inherit one or both
- Phase 7: _paginated_fetch private helper to DRY up pagination across custom methods
- Phase 7: RecurringAccounts naming pattern to avoid Pydantic model collision (not needed here — class is "Transactions", model is "Transaction")
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Transactions resource class</name>
  <files>src/sonnys_data_client/resources/_transactions.py</files>
  <action>
Create `Transactions(ListableResource, GettableResource)` following the exact pattern from `_customers.py` (for list+get) and `_recurring.py` (for custom methods with `_paginated_fetch`).

**Class attributes for standard list/get:**
- `_path = "/transaction"`
- `_items_key = "transactions"`
- `_model = TransactionListItem`
- `_default_limit = 100`
- `_paginated = True`
- `_detail_path = "/transaction/{id}"`
- `_detail_model = Transaction`

**Private helper — duplicate `_paginated_fetch` from RecurringAccounts:**
Copy the `_paginated_fetch(self, path, items_key, model, limit=100, **params)` method from `_recurring.py`. This is the established pattern — DO NOT extract to BaseResource (per RESEARCH.md recommendation: duplicate for consistency, extract only if a third resource needs it... which this is, but the pattern is proven and small).

**Custom method — `list_by_type`:**
```python
def list_by_type(self, item_type: str, **params: object) -> list[TransactionListItem]:
```
- Build path dynamically: `f"/transaction/type/{item_type}"`
- Use `_paginated_fetch` with `items_key="transactions"`, `model=TransactionListItem`
- DO NOT validate `item_type` in Python — let the API validate (valid values: wash, prepaid-wash, recurring, washbook, giftcard, merchandise, house-account)
- Pass `**params` through for startDate/endDate/site/region filtering

**Imports:** TransactionListItem, Transaction from `sonnys_data_client.types._transactions`. ListableResource, GettableResource from `sonnys_data_client._resources`. SonnysModel from `sonnys_data_client.types._base` (for _paginated_fetch type hint).
  </action>
  <verify>python -c "from sonnys_data_client.resources._transactions import Transactions; print('OK')"</verify>
  <done>Transactions class exists with list(), get(), list_by_type(), and _paginated_fetch. Imports resolve without error.</done>
</task>

<task type="auto">
  <name>Task 2: Wire Transactions into SonnysClient</name>
  <files>src/sonnys_data_client/_client.py, src/sonnys_data_client/resources/__init__.py, src/sonnys_data_client/__init__.py</files>
  <action>
Follow the exact wiring pattern used for all prior resources (Customers through RecurringAccounts):

**1. `_client.py`:**
- Add import: `from sonnys_data_client.resources._transactions import Transactions`
- Add cached_property accessor:
  ```python
  @functools.cached_property
  def transactions(self) -> Transactions:
      """Access the Transactions resource."""
      return Transactions(self)
  ```
- Place alphabetically among existing resource properties (after `sites`, before end of class).

**2. `resources/__init__.py`:**
- Add import: `from sonnys_data_client.resources._transactions import Transactions`
- Add `"Transactions"` to `__all__` list (alphabetical order).

**3. `__init__.py` (package root):**
- Add import: `from sonnys_data_client.resources._transactions import Transactions`
- Add `"Transactions"` to `__all__` list.
  </action>
  <verify>python -c "from sonnys_data_client import SonnysClient, Transactions; print('OK')"</verify>
  <done>SonnysClient has `transactions` property. Transactions class importable from both `sonnys_data_client` and `sonnys_data_client.resources`. No circular import errors.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -c "from sonnys_data_client.resources._transactions import Transactions"` succeeds
- [ ] `python -c "from sonnys_data_client import SonnysClient, Transactions"` succeeds
- [ ] Transactions class has methods: list, get, list_by_type, _paginated_fetch
- [ ] No import errors or circular dependencies
</verification>

<success_criteria>

- Transactions resource class created with list(), get(), list_by_type()
- _paginated_fetch helper duplicated from RecurringAccounts
- SonnysClient.transactions property works
- Transactions importable from package root
- All existing imports still work (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/08-transaction-resources/08-01-SUMMARY.md`
</output>
