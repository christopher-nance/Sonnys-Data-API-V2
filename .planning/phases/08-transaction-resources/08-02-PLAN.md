---
phase: 08-transaction-resources
plan: 02
type: execute
---

<objective>
Add the v2 list endpoint to the Transactions resource, completing Phase 8.

Purpose: The v2 endpoint returns enriched transaction summaries (customerId, recurringPlanSale/Redemption flags, transactionStatus) needed for analytics and reporting.
Output: Working `client.transactions.list_v2()` returning `TransactionV2ListItem` instances. Phase 8 complete.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase:
@.planning/phases/08-transaction-resources/08-01-SUMMARY.md

# Phase research:
@.planning/phases/08-transaction-resources/08-RESEARCH.md

# Key source files:
@src/sonnys_data_client/resources/_transactions.py
@src/sonnys_data_client/types/_transactions.py

**Established patterns:** _paginated_fetch for custom paginated endpoints (already in Transactions class from 08-01)
**Constraining decisions:**
- RESEARCH.md: v2 uses path "/transaction/version-2", model TransactionV2ListItem, same items_key "transactions"
- RESEARCH.md: v2 has 10-minute server-side response cache (document in docstring, no client-side mitigation)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add list_v2() method to Transactions resource</name>
  <files>src/sonnys_data_client/resources/_transactions.py</files>
  <action>
Add a `list_v2` method to the existing `Transactions` class:

```python
def list_v2(self, **params: object) -> list[TransactionV2ListItem]:
    """Fetch all transactions using the v2 endpoint.

    The v2 endpoint returns enriched list items with ``customer_id``,
    ``is_recurring_plan_sale``, ``is_recurring_plan_redemption``, and
    ``transaction_status`` fields.

    Note: The API caches v2 responses for 10 minutes per reporting criteria.

    Returns:
        A flat list of :class:`TransactionV2ListItem` instances.
    """
    return self._paginated_fetch(
        "/transaction/version-2",
        "transactions",
        TransactionV2ListItem,
        **params,
    )
```

**Import:** Add `TransactionV2ListItem` to the existing import from `sonnys_data_client.types._transactions`.

DO NOT modify any other methods — only add the new method and update the import line.
  </action>
  <verify>python -c "from sonnys_data_client.resources._transactions import Transactions; assert hasattr(Transactions, 'list_v2'); print('OK')"</verify>
  <done>Transactions.list_v2() method exists, uses _paginated_fetch with correct path/model/items_key. TransactionV2ListItem imported. No regressions to existing methods.</done>
</task>

</tasks>

<verification>
Before declaring Phase 8 complete:
- [ ] `python -c "from sonnys_data_client import SonnysClient, Transactions"` succeeds
- [ ] Transactions has all 4 public methods: list, get, list_by_type, list_v2
- [ ] Transactions has _paginated_fetch private helper
- [ ] No import errors or regressions
</verification>

<success_criteria>

- list_v2() method added to Transactions resource
- TransactionV2ListItem correctly imported
- All 4 transaction endpoints implemented (list, get, list_by_type, list_v2)
- Phase 8 complete — Transaction Resources fully implemented
</success_criteria>

<output>
After completion, create `.planning/phases/08-transaction-resources/08-02-SUMMARY.md`

Include in success criteria: "Phase 8 complete"
</output>
