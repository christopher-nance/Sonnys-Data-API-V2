---
phase: 04-response-models
plan: 02
type: execute
---

<objective>
Define Pydantic v2 models for Item, Giftcard, Washbook, and Recurring resource types.

Purpose: Cover the prepaid account ecosystem — items for sale, giftcards, washbooks (prepaid wash packages), and recurring membership accounts with their sub-objects.
Output: `_items.py`, `_giftcards.py`, `_washbooks.py`, `_recurring.py` under `src/sonnys_data_client/types/`.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-response-models/04-01-SUMMARY.md
@src/sonnys_data_client/types/_base.py
@bo-data-open-api.yml

**Tech stack available:** hatchling, requests, pydantic, pytest, ruff
**Established patterns:**
- SonnysModel base class with ConfigDict(populate_by_name=True, alias_generator=to_camel)
- Python 3.10+ native type syntax (str | None)
- Underscore-prefixed internals

**From Plan 04-01:**
- SonnysModel base class in `types/_base.py`
- Import pattern: `from sonnys_data_client.types._base import SonnysModel`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Item and Giftcard models</name>
  <files>src/sonnys_data_client/types/_items.py, src/sonnys_data_client/types/_giftcards.py</files>
  <action>
**_items.py:**

`Item(SonnysModel)` — from OpenAPI ItemObject:
- sku: str
- name: str
- department_name: str (enum: Wash, Detail, Service, Merchandise, Promotion/Coupon, GiftCard, WashBook, Recurring Plan, Add On, Vacuum Sales, Prepaid Wash)
- price_at_site: str (note: API returns price as string like "5.00")
- cost_per_item: str | None = None
- is_prompt_for_price: bool
- site_location: str

**_giftcards.py:**

`GiftcardListItem(SonnysModel)` — from OpenAPI GiftcardListItemObject:
- site_code: str
- complete_date: str
- number: str
- value: float
- amount_used: float
- giftcard_id: str
  </action>
  <verify>python -c "from sonnys_data_client.types._items import Item; from sonnys_data_client.types._giftcards import GiftcardListItem; i = Item(sku='123', name='Bronze', department_name='Wash', price_at_site='5.00', is_prompt_for_price=False, site_location='MAIN'); print(i.model_dump(by_alias=True)['departmentName'])"</verify>
  <done>Item and GiftcardListItem importable with correct fields. camelCase aliases work.</done>
</task>

<task type="auto">
  <name>Task 2: Create Washbook models with shared account sub-objects</name>
  <files>src/sonnys_data_client/types/_washbooks.py</files>
  <action>
Create _washbooks.py with all washbook-related models. These sub-objects are also used by recurring models (imported from here).

1. `WashbookTag(SonnysModel)` — from OpenAPI WashbookAccountTagNumberObject:
   - id: str
   - number: str
   - enabled: bool

2. `WashbookVehicle(SonnysModel)` — from OpenAPI WashbookAccountVehicleObject:
   - id: str
   - plate: str | None = None

3. `WashbookCustomer(SonnysModel)` — from OpenAPI WashbookAccountCustomerObject:
   - id: str | None = None
   - number: str | None = None
   - first_name: str | None = None
   - last_name: str | None = None

4. `WashbookRecurringInfo(SonnysModel)` — from OpenAPI WashbookAccountRecurringObject:
   - current_billable_amount: float
   - next_bill_date: str | None = None
   - last_bill_date: str | None = None
   - is_on_trial: bool
   - remaining_trial_periods: int

5. `WashbookListItem(SonnysModel)` — from OpenAPI WashbookListItemObject:
   - id: str
   - name: str | None = None
   - balance: str (note: API returns as string)
   - sign_up_date: str
   - cancel_date: str | None = None
   - billing_site_id: int
   - customer_id: str | None = None
   - status: str

6. `Washbook(SonnysModel)` — from OpenAPI WashbookAccountDetailObject:
   - id: str
   - name: str
   - balance: str | None = None (note: "999" means unlimited)
   - customer: WashbookCustomer
   - status: str
   - recurring_info: WashbookRecurringInfo
   - tags: list[WashbookTag]
   - vehicles: list[WashbookVehicle]
  </action>
  <verify>python -c "from sonnys_data_client.types._washbooks import WashbookTag, WashbookVehicle, WashbookCustomer, WashbookRecurringInfo, WashbookListItem, Washbook; w = Washbook(id='1:2', name='Gold', balance='5', customer=WashbookCustomer(), status='Active', recurring_info=WashbookRecurringInfo(current_billable_amount=10.0, is_on_trial=False, remaining_trial_periods=0), tags=[], vehicles=[]); print(w.model_dump(by_alias=True)['recurringInfo']['currentBillableAmount'])"</verify>
  <done>All 6 washbook models importable. Nested objects (customer, recurringInfo, tags, vehicles) work correctly. camelCase aliases verified.</done>
</task>

<task type="auto">
  <name>Task 3: Create Recurring models</name>
  <files>src/sonnys_data_client/types/_recurring.py</files>
  <action>
Create _recurring.py. Import shared sub-objects from _washbooks.py where needed.

1. `RecurringStatus(SonnysModel)` — from OpenAPI RecurringStatus:
   - status: str (enum: Active, Canceled, Suspended)
   - date: str

2. `RecurringBilling(SonnysModel)` — from OpenAPI RecurringBilling:
   - amount_charged: float
   - date: str
   - last_four_cc: str — NEEDS explicit Field(alias="lastFourCC") because to_camel("last_four_cc") produces "lastFourCc" not "lastFourCC"
   - credit_card_expiration_date: str | None = None

3. `RecurringListItem(SonnysModel)` — from OpenAPI RecurringWashbookListItemObject:
   - id: str
   - name: str | None = None
   - balance: float | None = None (note: always null for recurring per spec)
   - sign_up_date: str
   - cancel_date: str | None = None
   - billing_site_id: int
   - customer_id: str | None = None
   - status: int (numeric status code 1-15)
   - status_name: str (enum: Active, Payment Failed, Payment CC Expired, etc.)
   - billing_site_code: str

4. `Recurring(SonnysModel)` — from OpenAPI RecurringAccountDetailObject:
   - id: str
   - is_on_trial: bool
   - trial_amount: float
   - billing_site_code: str
   - creation_site_code: str
   - next_bill_date: str
   - tags: list[WashbookTag] (import from _washbooks)
   - vehicles: list[WashbookVehicle] (import from _washbooks)
   - last_bill_date: str | None = None
   - billing_amount: float | None = None
   - is_suspended: bool
   - suspended_until: str | None = None
   - current_recurring_status_name: str (enum: Active, Payment Failed, etc.)
   - plan_name: str
   - customer: WashbookCustomer (import from _washbooks)
   - recurring_statuses: list[RecurringStatus]
   - recurring_billings: list[RecurringBilling]
   - additional_tag_price: float | None = None

5. `RecurringStatusChange(SonnysModel)` — from OpenAPI RecurringWashbookStatusListItemObject.
   **IMPORTANT:** This model's API fields use snake_case (not camelCase). Override alias_generator:
   ```python
   model_config = ConfigDict(populate_by_name=True)  # No alias_generator
   ```
   - washbook_account_id: str
   - recurring_id: str
   - old_status: str
   - new_status: str
   - status_date: str
   - employee_name: str
   - site_code: str

6. `RecurringModification(SonnysModel)` — from OpenAPI RecurringWashbookListModificationItemObject.
   This extends Recurring (allOf RecurringAccountDetailObject) plus a modifications array. Define a sub-model for the modification entry:

   `RecurringModificationEntry(SonnysModel)`:
   - modification_type: str
   - modification_date: str
   - modification_comment: str | None = None

   `RecurringModification(Recurring)`:
   - modifications: list[RecurringModificationEntry]
  </action>
  <verify>python -c "from sonnys_data_client.types._recurring import RecurringStatus, RecurringBilling, RecurringListItem, Recurring, RecurringStatusChange, RecurringModification, RecurringModificationEntry; rb = RecurringBilling(amount_charged=5.0, date='2020-01-01', last_four_cc='XXXX0572'); print(rb.model_dump(by_alias=True)['lastFourCC']); sc = RecurringStatusChange(washbook_account_id='1:2', recurring_id='1:2', old_status='Active', new_status='Cancelled', status_date='2020-01-01', employee_name='System', site_code='MAIN'); print(sc.model_dump()['washbook_account_id'])"</verify>
  <done>All 8 recurring models importable. RecurringBilling.lastFourCC alias correct. RecurringStatusChange uses snake_case fields (no camelCase alias). Recurring nested objects work.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -c "from sonnys_data_client.types._items import Item"` succeeds
- [ ] `python -c "from sonnys_data_client.types._giftcards import GiftcardListItem"` succeeds
- [ ] `python -c "from sonnys_data_client.types._washbooks import WashbookTag, WashbookVehicle, WashbookCustomer, WashbookRecurringInfo, WashbookListItem, Washbook"` succeeds
- [ ] `python -c "from sonnys_data_client.types._recurring import RecurringStatus, RecurringBilling, RecurringListItem, Recurring, RecurringStatusChange, RecurringModification"` succeeds
- [ ] RecurringBilling alias override: `lastFourCC` not `lastFourCc`
- [ ] RecurringStatusChange snake_case: no camelCase aliases
- [ ] Nested objects: Recurring.tags accepts WashbookTag list, Recurring.customer accepts WashbookCustomer
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- 16 models defined across 4 files (_items.py, _giftcards.py, _washbooks.py, _recurring.py)
- Alias overrides correct for non-standard API field names
- No import errors or circular dependencies
</success_criteria>

<output>
After completion, create `.planning/phases/04-response-models/04-02-SUMMARY.md`
</output>
