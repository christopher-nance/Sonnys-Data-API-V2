---
phase: 04-response-models
plan: 03
type: execute
---

<objective>
Define Employee and Site Pydantic v2 models, then wire up the full types export and write model validation tests.

Purpose: Complete the response model layer — all 8 API resource types have Pydantic models. Export everything from `types/__init__.py` so consuming code imports cleanly.
Output: `_employees.py`, `_sites.py` under `src/sonnys_data_client/types/`, updated `__init__.py`, and `tests/test_types.py`.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-response-models/04-01-SUMMARY.md
@.planning/phases/04-response-models/04-02-SUMMARY.md
@src/sonnys_data_client/types/_base.py
@src/sonnys_data_client/types/__init__.py
@bo-data-open-api.yml

**Tech stack available:** hatchling, requests, pydantic, pytest, ruff
**Established patterns:**
- SonnysModel base class with ConfigDict(populate_by_name=True, alias_generator=to_camel)
- Python 3.10+ native type syntax (str | None)
- Underscore-prefixed internals, public API via __init__.py
- Test pattern from Phase 2-3: tests/ directory, pytest

**From Plans 04-01 and 04-02:**
- SonnysModel base class in `types/_base.py`
- Transaction, Customer, Item, Giftcard, Washbook, Recurring models all defined
- Import pattern: `from sonnys_data_client.types._base import SonnysModel`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Employee and Site models</name>
  <files>src/sonnys_data_client/types/_employees.py, src/sonnys_data_client/types/_sites.py</files>
  <action>
**_employees.py:**

1. `ClockEntry(SonnysModel)` — from OpenAPI EmployeeClockEntryObject:
   - clock_in: str | None = None
   - clock_out: str | None = None
   - regular_rate: float
   - regular_hours: float
   - overtime_eligible: bool
   - overtime_rate: float
   - overtime_hours: float
   - was_modified: bool
   - modification_timestamp: str | None = None
   - was_created_in_back_office: bool
   - site_code: str

2. `EmployeeListItem(SonnysModel)` — from OpenAPI EmployeeListItemObject:
   - first_name: str
   - last_name: str
   - employee_id: int

3. `Employee(SonnysModel)` — from OpenAPI EmployeeDetailsObject:
   - employee_id: int
   - first_name: str
   - last_name: str
   - active: bool
   - start_date: str
   - start_date_change: str
   - phone: str | None = None
   - email: str | None = None

**_sites.py:**

`Site(SonnysModel)` — from OpenAPI SiteObject:
- site_id: int — NEEDS explicit Field(alias="siteID") because to_camel("site_id") produces "siteId" not "siteID"
- code: str | None = None
- name: str
- timezone: str | None = None
  </action>
  <verify>python -c "from sonnys_data_client.types._employees import ClockEntry, EmployeeListItem, Employee; from sonnys_data_client.types._sites import Site; s = Site(site_id=1, name='MAIN SITE', code='MAIN'); print(s.model_dump(by_alias=True)['siteID'])"</verify>
  <done>ClockEntry, EmployeeListItem, Employee, Site importable. Site.siteID alias correct (not siteId). All fields match OpenAPI spec.</done>
</task>

<task type="auto">
  <name>Task 2: Export all models from types/__init__.py and write validation tests</name>
  <files>src/sonnys_data_client/types/__init__.py, tests/test_types.py</files>
  <action>
**types/__init__.py:**
Export ALL models from all type modules. This is the public API surface for types:

```python
from sonnys_data_client.types._base import SonnysModel

from sonnys_data_client.types._transactions import (
    TransactionTender,
    TransactionItem,
    TransactionDiscount,
    TransactionListItem,
    TransactionV2ListItem,
    Transaction,
    TransactionJobItem,
)

from sonnys_data_client.types._customers import (
    Address,
    CustomerListItem,
    Customer,
)

from sonnys_data_client.types._items import Item

from sonnys_data_client.types._giftcards import GiftcardListItem

from sonnys_data_client.types._washbooks import (
    WashbookTag,
    WashbookVehicle,
    WashbookCustomer,
    WashbookRecurringInfo,
    WashbookListItem,
    Washbook,
)

from sonnys_data_client.types._recurring import (
    RecurringStatus,
    RecurringBilling,
    RecurringListItem,
    Recurring,
    RecurringStatusChange,
    RecurringModificationEntry,
    RecurringModification,
)

from sonnys_data_client.types._employees import (
    ClockEntry,
    EmployeeListItem,
    Employee,
)

from sonnys_data_client.types._sites import Site
```

Include `__all__` listing every exported name.

**tests/test_types.py:**
Write tests that validate models parse realistic JSON data (using examples from the OpenAPI spec). Cover:

1. **TestSonnysModelBase**: Test that alias_generator produces camelCase, populate_by_name allows both snake_case and camelCase input.

2. **TestTransactionModels**: Parse a TransactionV2ListItem from camelCase dict `{"transNumber": 100, "transId": "1:2", "total": 10.0, "date": "2020-01-01", "customerId": null, "isRecurringPlanSale": false, "isRecurringPlanRedemption": false, "transactionStatus": "Completed"}`. Verify fields accessible as snake_case. Parse a Transaction detail with nested tenders and items arrays.

3. **TestCustomerModels**: Parse CustomerListItem and Customer with nested Address from camelCase dicts.

4. **TestAccountModels**: Parse a Washbook with nested customer, recurringInfo, tags, vehicles. Parse a Recurring with nested recurringStatuses and recurringBillings arrays.

5. **TestRecurringStatusChange**: Verify snake_case fields parse without camelCase aliases.

6. **TestSiteModel**: Verify Site parses `{"siteID": 1, "code": "MAIN", "name": "Main Site"}` — the `siteID` alias.

7. **TestRecurringBilling**: Verify `lastFourCC` alias works correctly.

Target: ~15-20 test cases covering all model families and edge cases (nullable fields, nested objects, alias overrides).
  </action>
  <verify>cd "C:\Users\chris\OneDrive - WashU Carwash\Projects\Sonny's Data API V2" && python -m pytest tests/test_types.py -v</verify>
  <done>types/__init__.py exports all 29 models. All test cases pass. Every model family validated with realistic JSON data. Alias overrides (siteID, lastFourCC) and snake_case model (RecurringStatusChange) verified.</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `python -m pytest tests/test_types.py -v` — all tests pass
- [ ] `python -c "from sonnys_data_client.types import *"` — no import errors
- [ ] `python -c "from sonnys_data_client.types import Transaction, Customer, Item, GiftcardListItem, Washbook, Recurring, Employee, Site; print('All 8 resource types importable')"` succeeds
- [ ] Count models in `__all__`: should be 29 (SonnysModel + 28 resource models)
- [ ] No circular import issues between _washbooks and _recurring
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- 4 new models (ClockEntry, EmployeeListItem, Employee, Site) defined
- types/__init__.py exports all 29 models
- tests/test_types.py passes with ~15-20 test cases
- Phase 4 complete — all 8 API resource types have Pydantic v2 models
</success_criteria>

<output>
After completion, create `.planning/phases/04-response-models/04-03-SUMMARY.md`:

# Phase 4 Plan 3: Employee, Site Models + Types Export Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- [File list]

## Decisions Made

[Key decisions]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 4 complete, ready for Phase 5: Resource Framework
</output>
