---
phase: 15-account-resources-guide
plan: 01
type: execute
---

<objective>
Add advanced patterns to the account resource guides (giftcards, recurring) and deploy.

Purpose: Complete the account resources deep dive with method comparison, churn analysis, billing reporting, and liability tracking patterns.
Output: Enhanced docs/guides/recurring.md and docs/guides/giftcards.md with advanced patterns, deployed docs site.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-resource-guides/13-02-SUMMARY.md
@.planning/phases/14-transaction-deep-dive/14-02-SUMMARY.md

@docs/guides/recurring.md
@docs/guides/giftcards.md
@docs/guides/washbooks.md
@src/sonnys_data_client/resources/_recurring.py
@src/sonnys_data_client/resources/_giftcards.py
@src/sonnys_data_client/types/_recurring.py
@src/sonnys_data_client/types/_giftcards.py
@mkdocs.yml

**Constraining decisions:**
- Phase 13-02: Standard-depth guides for account/transaction resources; Phases 14-15 will deep-dive
- Phase 14: Established deep dive pattern — comparison table → advanced patterns → deploy
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add advanced patterns to account resource guides</name>
  <files>docs/guides/recurring.md, docs/guides/giftcards.md</files>
  <action>
**In docs/guides/recurring.md:**

1. Insert a "## Choosing the Right Method" section BEFORE the "## Methods" section. Add a comparison table for the 5 recurring methods:

| Method | Returns | Use When | Pagination |
|--------|---------|----------|------------|
| `list()` | `RecurringListItem` | Quick summaries, filtering by date/site | Auto |
| `get()` | `Recurring` | Full detail for a single account | N/A |
| `list_status_changes()` | `RecurringStatusChange` | Tracking cancellations, reactivations | Auto |
| `list_modifications()` | `RecurringModification` | Audit trail, plan changes, account edits | Auto |
| `list_details()` | `Recurring` | Bulk export with full detail (heavier) | Auto |

Add a paragraph guiding users: start with `list()` for summaries, use `get()` for single-account deep dives, use `list_status_changes()` for churn/retention analysis, `list_modifications()` for audit trails, and `list_details()` only when you need full nested data (tags, vehicles, billing history) in bulk.

2. Insert an "## Advanced Patterns" section AFTER the "## Models" section (before the shared nested types admonition note). Include these subsections:

**"### Churn Analysis"** — Show how to use `list_status_changes()` to analyze account churn:

```python
from collections import Counter
from sonnys_data_client import SonnysClient

with SonnysClient(api_id="your-api-id", api_key="your-api-key") as client:
    changes = client.recurring.list_status_changes(
        startDate="2025-06-01",
        endDate="2025-06-30",
    )

    # Count transitions by type
    transitions = Counter(
        f"{c.old_status} → {c.new_status}" for c in changes
    )
    for transition, count in transitions.most_common():
        print(f"{transition}: {count}")

    # Find cancellations
    cancellations = [c for c in changes if c.new_status.lower() == "cancelled"]
    print(f"\n{len(cancellations)} cancellations this month")
    for c in cancellations:
        print(f"  Account {c.recurring_id} at {c.site_code} on {c.status_date}")
```

**"### Billing History Report"** — Show how to use `list_details()` to build a billing summary:

```python
with SonnysClient(api_id="your-api-id", api_key="your-api-key") as client:
    accounts = client.recurring.list_details(
        startDate="2025-06-01",
        endDate="2025-06-30",
    )

    total_revenue = 0.0
    for acct in accounts:
        acct_total = sum(b.amount_charged for b in acct.recurring_billings)
        total_revenue += acct_total
        if acct_total > 0:
            print(
                f"Account {acct.id} ({acct.plan_name}): "
                f"${acct_total:.2f} over {len(acct.recurring_billings)} billings"
            )

    print(f"\nTotal recurring revenue: ${total_revenue:.2f}")
```

Add a warning admonition reminding users that `list_details()` is heavier than `list()` and should be used only when billing/status history data is needed.

**In docs/guides/giftcards.md:**

1. Insert an "## Advanced Patterns" section AFTER the "## Models" section (before the auto-pagination admonition note). Include one subsection:

**"### Liability Tracking with Transactions"** — Show how to combine gift card data with transaction data to track redemptions:

```python
from sonnys_data_client import SonnysClient

with SonnysClient(api_id="your-api-id", api_key="your-api-key") as client:
    giftcards = client.giftcards.list()
    gc_txns = client.transactions.list_by_type(
        "giftcard",
        startDate="2025-06-01",
        endDate="2025-06-30",
    )

    # Outstanding liability
    total_liability = sum(gc.value - gc.amount_used for gc in giftcards)
    print(f"Total outstanding liability: ${total_liability:.2f}")
    print(f"Gift card transactions this month: {len(gc_txns)}")
    print(f"Active cards: {sum(1 for gc in giftcards if gc.value > gc.amount_used)}")
```

2. REMOVE the Phase 15 forward-reference tip at the bottom of giftcards.md (the admonition starting with `!!! tip "Advanced patterns"`). Keep the auto-pagination note.
  </action>
  <verify>Run `cd "C:\Users\chris\OneDrive - WashU Carwash\Projects\Sonny's Data API V2" && python -m mkdocs build --strict 2>&1` — should complete with zero warnings and zero errors. Verify the Phase 15 forward-reference tip is removed from giftcards.md.</verify>
  <done>Recurring guide has method comparison table and advanced patterns (churn analysis, billing report). Giftcards guide has liability tracking pattern. Phase 15 forward-reference removed. mkdocs build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Deploy documentation site</name>
  <files>docs/guides/recurring.md, docs/guides/giftcards.md</files>
  <action>
Deploy the updated documentation to GitHub Pages:

```bash
cd "C:\Users\chris\OneDrive - WashU Carwash\Projects\Sonny's Data API V2"
python -m mkdocs gh-deploy --strict --force
```

Verify the deployment succeeds without errors.
  </action>
  <verify>mkdocs gh-deploy completes successfully. The account resource guides are live on GitHub Pages.</verify>
  <done>Documentation deployed to GitHub Pages. Phase 15 complete.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -m mkdocs build --strict` succeeds with zero warnings
- [ ] Recurring guide has "Choosing the Right Method" comparison table
- [ ] Recurring guide has "Advanced Patterns" section with churn analysis and billing report
- [ ] Giftcards guide has "Advanced Patterns" section with liability tracking
- [ ] Phase 15 forward-reference tip removed from giftcards guide
- [ ] Documentation deployed to GitHub Pages
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No mkdocs build warnings or errors
- Documentation deployed to GitHub Pages
- Account resource guides enhanced with practical advanced patterns
</success_criteria>

<output>
After completion, create `.planning/phases/15-account-resources-guide/15-01-SUMMARY.md`
</output>
