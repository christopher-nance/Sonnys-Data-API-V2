---
phase: 23-membership-analytics
plan: 01
type: execute
---

<objective>
Implement `client.stats.new_memberships_sold()` returning the count of recurring account activations within a date range.

Purpose: Provide membership sales metric needed as numerator for Phase 24 conversion rate calculation.
Output: Working `new_memberships_sold(start, end)` method on StatsResource returning int.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (dependency graph):
@.planning/phases/20-data-fetching/20-01-SUMMARY.md
@.planning/phases/22-wash-analytics/22-01-SUMMARY.md

# Key source files:
@src/sonnys_data_client/resources/_stats.py
@src/sonnys_data_client/types/_recurring.py

**Tech stack available:** Pydantic v2, requests, parse_date_range utility
**Established patterns:**
- Int-return stat methods: simple count stats return int directly (retail_wash_count)
- _fetch_* private methods as data retrieval layer
- _resolve_dates() as shared date pipeline
- Google-style docstrings on all public methods

**Constraining decisions:**
- [Phase 20]: No caching — efficiency from report() calling once
- [Phase 22]: Each stat method makes independent API calls — efficiency deferred to Phase 25
- [Phase 22]: Int-return pattern for simple counts (used by conversion rate denominator)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement new_memberships_sold() on StatsResource</name>
  <files>src/sonnys_data_client/resources/_stats.py</files>
  <action>
Add `new_memberships_sold(self, start, end) -> int` method to StatsResource.

Implementation:
1. Call `self._fetch_recurring_status_changes(start, end)` to get all status changes in range
2. Filter for changes where `change.new_status == "Active"` — these represent membership activations (new sign-ups and reactivations)
3. Return `len(filtered_changes)` as int

Follow the exact pattern of `retail_wash_count()`:
- Same signature: `(self, start: str | datetime, end: str | datetime) -> int`
- Same structure: fetch data, filter, return count
- Same docstring style: Google-style with Args, Returns, Raises, Example sections

Place the method after `retail_wash_count()` and before `total_sales()` to keep stat methods grouped logically (simple int-return methods together, model-return methods together).

The docstring should note this counts status transitions to "Active" which includes both new sign-ups and reactivations. This value serves as the numerator for conversion rate (Phase 24).
  </action>
  <verify>python -c "from sonnys_data_client.resources._stats import StatsResource; assert hasattr(StatsResource, 'new_memberships_sold')"</verify>
  <done>new_memberships_sold() method exists on StatsResource, accepts (start, end), returns int, has Google-style docstring</done>
</task>

<task type="auto">
  <name>Task 2: Verify integration with existing test suite</name>
  <files>tests/test_types.py</files>
  <action>
Run the full test suite to confirm no regressions.

Since new_memberships_sold() returns int (no new Pydantic model), no changes to test_types.py __all__ assertion are needed. Verify this is the case — the count should still be 32 (from Phase 22 WashResult addition).

If test_types.py assertion fails, update the count. Otherwise, confirm all 123+ tests pass unchanged.
  </action>
  <verify>cd "C:\Users\chris\OneDrive - WashU Carwash\Projects\Sonny's Data API V2" && python -m pytest tests/ -q</verify>
  <done>All existing tests pass with zero regressions, no __all__ count changes needed</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `new_memberships_sold()` method exists on StatsResource
- [ ] Method filters RecurringStatusChange records for new_status == "Active"
- [ ] Method returns int (matching int-return pattern)
- [ ] Google-style docstring with Args, Returns, Raises, Example
- [ ] `python -m pytest tests/ -q` passes all tests
- [ ] No new types/models needed (int return)
</verification>

<success_criteria>

- new_memberships_sold() implemented and callable via client.stats.new_memberships_sold(start, end)
- Returns int count of membership activations
- All existing tests pass
- Method ready as numerator for Phase 24 conversion_rate()
- Phase 23 complete
</success_criteria>

<output>
After completion, create `.planning/phases/23-membership-analytics/23-01-SUMMARY.md`
</output>
